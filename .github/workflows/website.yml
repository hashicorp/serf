name: website
on:
  push:
    branches:
      - master
      - gha_migration_master
env:
  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  FASTLY_API_TOKEN: ${{ secrets.FASTLY_API_TOKEN }}
jobs:
  build-website:
    runs-on: ubuntu-latest
    container:
      image: docker.mirror.hashicorp.services/hashicorp/middleman-hashicorp:0.3.47
    steps:
    - uses: actions/checkout@v3.3.0
    - name: install gems
      run: |
        cd website && bundle install --path vendor/bundle --retry=3
    - name: middleman build
      run: |
        cd website && bundle exec middleman build
    - name: website deploy
      run: echo "calling the deploy script"
      # run: cd website && ./scripts/deploy.sh
